<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Vendas TIM</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h1>Painel de Vendas TIM</h1>
        
        <!-- Botões da Home -->
        <div class="home-buttons">
            <button onclick="window.location.href='ficha.html'">Ficha TIM</button>
            <button onclick="window.location.href='ficha.html'">Ficha TIM Empresas</button>
            <button onclick="window.location.href='ficha.html'">Ficha TIM Ultrafibra</button>
        </div>

        <!-- Formulário de Ficha -->
        <div id="formulario" style="display: none;">
            <h2>Nova Ficha</h2>
            <form id="fichaForm">
                <!-- Dados da Empresa -->
                <fieldset>
                    <legend>Dados da Empresa</legend>
                    <div class="form-group">
                        <label for="cnpj">CNPJ:</label>
                        <input type="text" id="cnpj" name="cnpj" required>
                    </div>
                    <div class="form-group">
                        <label for="razaoSocial">Razão Social:</label>
                        <input type="text" id="razaoSocial" name="razaoSocial" required>
                    </div>
                    <div class="form-group">
                        <label for="nomeFantasia">Nome Fantasia:</label>
                        <input type="text" id="nomeFantasia" name="nomeFantasia">
                    </div>
                    <!-- Adicione os outros campos da empresa aqui -->
                </fieldset>

                <!-- Dados do Representante -->
                <fieldset>
                    <legend>Dados do Representante</legend>
                    <div class="form-group">
                        <label for="nomeRepresentante">Nome:</label>
                        <input type="text" id="nomeRepresentante" name="nomeRepresentante" required>
                    </div>
                    <div class="form-group">
                        <label for="rg">RG:</label>
                        <input type="text" id="rg" name="rg" required>
                    </div>
                    <div class="form-group">
                        <label for="cpf">CPF:</label>
                        <input type="text" id="cpf" name="cpf" required>
                    </div>
                    <!-- Adicione os outros campos do representante aqui -->
                </fieldset>

                <!-- Planos -->
                <fieldset>
                    <legend>Planos</legend>
                    <div class="form-group">
                        <label for="planoBlack">Plano Black:</label>
                        <select id="planoBlack" name="planoBlack">
                            <option value="">Selecione um plano</option>
                            <option value="plano1">Plano 1</option>
                            <option value="plano2">Plano 2</option>
                            <option value="plano3">Plano 3</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="quantidadeLinhas">Quantidade de Linhas:</label>
                        <input type="number" id="quantidadeLinhas" name="quantidadeLinhas" min="1">
                    </div>
                    <!-- Adicione os outros campos de planos aqui -->
                </fieldset>

                <button type="submit">Salvar Ficha</button>
            </form>
        </div>

        <!-- Lista de Fichas Salvas -->
        <div id="fichasSalvas" style="display: none;">
            <h2>Fichas Salvas</h2>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Buscar por CNPJ...">
                <button onclick="buscarFichas()">Buscar</button>
            </div>
            <div id="fichasList"></div>
        </div>
    </div>

    <script src="js/database.js"></script>
    <script>
        // Função para mostrar o formulário quando clicar em um dos botões
        document.querySelectorAll('.home-buttons button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelector('.home-buttons').style.display = 'none';
                document.getElementById('formulario').style.display = 'block';
                document.getElementById('fichasSalvas').style.display = 'block';
            });
        });

        // Função para salvar a ficha
        document.getElementById('fichaForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const dados = Object.fromEntries(formData.entries());
            
            try {
                await database.salvarFicha(dados);
                alert('Ficha salva com sucesso!');
                e.target.reset();
                buscarFichas(); // Atualiza a lista de fichas
            } catch (error) {
                alert('Erro ao salvar ficha: ' + error.message);
            }
        });

        // Função para buscar e exibir as fichas
        async function buscarFichas() {
            try {
                const searchInput = document.getElementById('searchInput');
                const cnpj = searchInput.value.trim();
                
                let fichas;
                if (cnpj) {
                    // Se houver um CNPJ digitado, busca apenas essa ficha
                    const ficha = await database.buscarFichaPorCNPJ(cnpj);
                    fichas = ficha ? [ficha] : [];
                } else {
                    // Se não houver CNPJ, busca todas as fichas
                    fichas = await database.buscarFichas();
                }
                
                const fichasList = document.getElementById('fichasList');
                
                if (fichas.length === 0) {
                    fichasList.innerHTML = '<p>Nenhuma ficha encontrada</p>';
                    return;
                }
                
                fichasList.innerHTML = fichas.map(ficha => `
                    <div class="ficha-card">
                        <h3>${ficha.razaoSocial}</h3>
                        <p>CNPJ: ${ficha.cnpj}</p>
                        <p>Representante: ${ficha.nomeRepresentante}</p>
                        <div class="ficha-actions">
                            <button onclick="editarFicha('${ficha.cnpj}')">Editar</button>
                            <button onclick="deletarFicha('${ficha.cnpj}')">Deletar</button>
                            <button onclick="enviarWhatsApp('${ficha.cnpj}')">Enviar WhatsApp</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Erro ao buscar fichas:', error);
                document.getElementById('fichasList').innerHTML = '<p>Erro ao buscar fichas</p>';
            }
        }

        // Função para editar ficha
        async function editarFicha(cnpj) {
            try {
                const ficha = await database.buscarFichaPorCNPJ(cnpj);
                // Preencher o formulário com os dados da ficha
                Object.keys(ficha).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) {
                        input.value = ficha[key];
                    }
                });
            } catch (error) {
                alert('Erro ao buscar ficha: ' + error.message);
            }
        }

        // Função para deletar ficha
        async function deletarFicha(cnpj) {
            if (confirm('Tem certeza que deseja deletar esta ficha?')) {
                try {
                    await database.deletarFicha(cnpj);
                    alert('Ficha deletada com sucesso!');
                    buscarFichas(); // Atualiza a lista de fichas
                } catch (error) {
                    alert('Erro ao deletar ficha: ' + error.message);
                }
            }
        }

        // Função para enviar WhatsApp
        function enviarWhatsApp(cnpj) {
            // Implementar a lógica de envio para WhatsApp
            alert('Funcionalidade de envio para WhatsApp em desenvolvimento');
        }

        // Carregar fichas ao iniciar a página
        buscarFichas();
    </script>
</body>
</html> 