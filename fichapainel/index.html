<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha TIM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <div class="d-flex justify-content-between w-100">
                <img src="images/tim-logo.svg" alt="TIM Logo" class="navbar-brand" height="40">
                <img src="images/valen-logo.svg" alt="Valen Logo" class="navbar-brand" height="40">
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <form id="fichaForm" class="needs-validation" novalidate>
            <!-- Dados da Empresa -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Dados da Empresa</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="cnpj" class="form-label">CNPJ</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="cnpj" required>
                                <button type="button" class="btn btn-primary" id="pesquisarCnpj">Pesquisar</button>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="razaoSocial" class="form-label">Razão Social</label>
                            <input type="text" class="form-control" id="razaoSocial" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="nomeFantasia" class="form-label">Nome Fantasia</label>
                            <input type="text" class="form-control" id="nomeFantasia">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="dataAbertura" class="form-label">Data de Abertura</label>
                            <input type="date" class="form-control" id="dataAbertura">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="inscricaoEstadual" class="form-label">Inscrição Estadual</label>
                            <input type="text" class="form-control" id="inscricaoEstadual">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="situacaoCadastral" class="form-label">Situação Cadastral</label>
                            <input type="text" class="form-control" id="situacaoCadastral">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="atividadePrincipal" class="form-label">Atividade Principal</label>
                            <input type="text" class="form-control" id="atividadePrincipal">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="naturezaJuridica" class="form-label">Natureza Jurídica</label>
                            <input type="text" class="form-control" id="naturezaJuridica">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dados do Representante Legal -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Dados do Representante Legal</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nomeRepresentante" class="form-label">Nome</label>
                            <input type="text" class="form-control" id="nomeRepresentante" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="rg" class="form-label">RG</label>
                            <input type="text" class="form-control" id="rg" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="cpf" class="form-label">CPF</label>
                            <input type="text" class="form-control" id="cpf" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="dataNascimento" class="form-label">Data de Nascimento</label>
                            <input type="date" class="form-control" id="dataNascimento" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">E-mail</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="telefone" class="form-label">Telefone</label>
                            <input type="tel" class="form-control" id="telefone" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Endereço -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Endereço</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="cep" class="form-label">CEP</label>
                            <input type="text" class="form-control" id="cep" required>
                        </div>
                        <div class="col-md-8 mb-3">
                            <label for="logradouro" class="form-label">Logradouro</label>
                            <input type="text" class="form-control" id="logradouro" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="numero" class="form-label">Número</label>
                            <input type="text" class="form-control" id="numero" required>
                        </div>
                        <div class="col-md-8 mb-3">
                            <label for="complemento" class="form-label">Complemento</label>
                            <input type="text" class="form-control" id="complemento">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="bairro" class="form-label">Bairro</label>
                            <input type="text" class="form-control" id="bairro" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="cidade" class="form-label">Cidade</label>
                            <input type="text" class="form-control" id="cidade" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="estado" class="form-label">Estado</label>
                            <select class="form-select" id="estado" required>
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Endereço de Entrega -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Endereço de Entrega</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <select class="form-select" id="enderecoEntrega" required>
                            <option value="sim">Mesmo endereço acima</option>
                            <option value="nao">Outro endereço</option>
                        </select>
                    </div>
                    <div id="outroEndereco" style="display: none;">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="cepEntrega" class="form-label">CEP</label>
                                <input type="text" class="form-control" id="cepEntrega">
                            </div>
                            <div class="col-md-8 mb-3">
                                <label for="logradouroEntrega" class="form-label">Logradouro</label>
                                <input type="text" class="form-control" id="logradouroEntrega">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="numeroEntrega" class="form-label">Número</label>
                                <input type="text" class="form-control" id="numeroEntrega">
                            </div>
                            <div class="col-md-8 mb-3">
                                <label for="complementoEntrega" class="form-label">Complemento</label>
                                <input type="text" class="form-control" id="complementoEntrega">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="bairroEntrega" class="form-label">Bairro</label>
                                <input type="text" class="form-control" id="bairroEntrega">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cidadeEntrega" class="form-label">Cidade</label>
                                <input type="text" class="form-control" id="cidadeEntrega">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="estadoEntrega" class="form-label">Estado</label>
                                <select class="form-select" id="estadoEntrega">
                                    <option value="">Selecione...</option>
                                    <option value="AC">Acre</option>
                                    <option value="AL">Alagoas</option>
                                    <option value="AP">Amapá</option>
                                    <option value="AM">Amazonas</option>
                                    <option value="BA">Bahia</option>
                                    <option value="CE">Ceará</option>
                                    <option value="DF">Distrito Federal</option>
                                    <option value="ES">Espírito Santo</option>
                                    <option value="GO">Goiás</option>
                                    <option value="MA">Maranhão</option>
                                    <option value="MT">Mato Grosso</option>
                                    <option value="MS">Mato Grosso do Sul</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="PA">Pará</option>
                                    <option value="PB">Paraíba</option>
                                    <option value="PR">Paraná</option>
                                    <option value="PE">Pernambuco</option>
                                    <option value="PI">Piauí</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="RN">Rio Grande do Norte</option>
                                    <option value="RS">Rio Grande do Sul</option>
                                    <option value="RO">Rondônia</option>
                                    <option value="RR">Roraima</option>
                                    <option value="SC">Santa Catarina</option>
                                    <option value="SP">São Paulo</option>
                                    <option value="SE">Sergipe</option>
                                    <option value="TO">Tocantins</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Planos -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Planos</h5>
                </div>
                <div class="card-body">
                    <!-- TIM Black Empresa -->
                    <div class="mb-4">
                        <h6>TIM Black Empresa</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="planoBlack" class="form-label">Selecione o Plano</label>
                                <select class="form-select" id="planoBlack">
                                    <option value="">Selecione um plano</option>
                                    <option value="6GB">6GB - R$ 39,99 (NV/AD B 4GB + 2GB V0325)</option>
                                    <option value="30GB">30GB - R$ 52,99 (NV/AD B 10GB + 20GB V0325)</option>
                                    <option value="40GB">40GB - R$ 64,99 (NV/AD B 20GB + 20GB V0325)</option>
                                    <option value="50GB">50GB - R$ 69,99 (NV/AD B 30GB + 20GB V0325)</option>
                                    <option value="80GB">80GB - R$ 79,99 (NV/AD B 30GB + 50GB V0325)</option>
                                    <option value="100GB">100GB - R$ 99,99 (NV/AD B 50GB + 50GB V0325)</option>
                                    <option value="150GB">150GB - R$ 149,99 (NV/AD B 100GB + 50GB DZ0124)</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="quantidadeLinhas" class="form-label">Quantidade de Linhas</label>
                                <input type="number" class="form-control" id="quantidadeLinhas" min="1" max="1000">
                                <small class="text-muted">(Máximo: 1000 linhas)</small>
                            </div>
                        </div>
                    </div>

                    <!-- TIM Ultrafibra -->
                    <div class="mb-4">
                        <h6>TIM Ultrafibra</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="planoUltrafibra" class="form-label">Selecione o Plano</label>
                                <select class="form-select" id="planoUltrafibra">
                                    <option value="">Selecione um plano</option>
                                    <option value="300">300 MEGA - R$ 79,99/mês</option>
                                    <option value="400">400 MEGA - R$ 99,99/mês</option>
                                    <option value="600">600 MEGA - R$ 109,99/mês</option>
                                    <option value="700">700 MEGA+ - R$ 119,99/mês</option>
                                    <option value="700max">700 MEGA+ MAX - R$ 129,99/mês</option>
                                    <option value="1giga">1 GIGA - R$ 139,99/mês</option>
                                    <option value="1gigamax">1 GIGA+ MAX - R$ 149,99/mês</option>
                                    <option value="2gigamax">2 GIGA+ MAX - R$ 369,99/mês</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="dataVencimento" class="form-label">Data de Vencimento</label>
                                <select class="form-select" id="dataVencimento">
                                    <option value="">Selecione o dia</option>
                                    <option value="5">Dia 5</option>
                                    <option value="10">Dia 10</option>
                                    <option value="15">Dia 15</option>
                                    <option value="20">Dia 20</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="tipoLinha" class="form-label">Tipo de Linha</label>
                                <select class="form-select" id="tipoLinha">
                                    <option value="">Selecione o tipo</option>
                                    <option value="nova">Nova</option>
                                    <option value="portabilidade">Portabilidade</option>
                                    <option value="migracao">Migração</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botões de Ação -->
            <div class="text-center mb-4">
                <button type="button" class="btn btn-secondary me-2" onclick="limparFormulario()">
                    <i class="bi bi-x-circle me-2"></i>Limpar
                </button>
                <button type="button" class="btn btn-success me-2" onclick="salvarFicha()">
                    <i class="bi bi-save me-2"></i>Salvar
                </button>
                <button type="button" class="btn btn-primary" onclick="enviarWhatsApp()">
                    <i class="bi bi-whatsapp me-2"></i>Enviar via WhatsApp
                </button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function consultarCNPJ() {
            const cnpj = document.getElementById('cnpj').value.replace(/\D/g, '');
            if (!cnpj) {
                alert('Informe um CNPJ válido!');
                return;
            }
            
            try {
                const res = await fetch('/api/consulta-cnpj', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cnpj })
                });
                
                if (!res.ok) {
                    throw new Error('Erro na consulta');
                }
                
                const data = await res.json();
                
                if (data.status === 'ERROR' || data.error) {
                    alert('CNPJ não encontrado ou inválido!');
                    return;
                }
                
                // Preencher os campos com os dados retornados
                document.getElementById('razaoSocial').value = data.nome || '';
                document.getElementById('nomeFantasia').value = data.fantasia || '';
                document.getElementById('dataAbertura').value = data.abertura ? data.abertura.split('/').reverse().join('-') : '';
                document.getElementById('situacaoCadastral').value = data.situacao || '';
                document.getElementById('atividadePrincipal').value = data.atividade_principal?.texto || '';
                document.getElementById('naturezaJuridica').value = data.natureza_juridica || '';
                document.getElementById('cep').value = data.cep || '';
                document.getElementById('logradouro').value = data.logradouro || '';
                document.getElementById('numero').value = data.numero || '';
                document.getElementById('complemento').value = data.complemento || '';
                document.getElementById('bairro').value = data.bairro || '';
                document.getElementById('cidade').value = data.municipio || '';
                document.getElementById('estado').value = data.uf || '';
                
            } catch (error) {
                console.error('Erro ao consultar CNPJ:', error);
                alert('Erro ao consultar CNPJ. Por favor, tente novamente.');
            }
        }

        function limparFormulario() {
            document.getElementById('fichaForm').reset();
            document.getElementById('outroEndereco').style.display = 'none';
        }

        function salvarFicha() {
            // Implementar lógica de salvamento
            alert('Funcionalidade de salvamento em desenvolvimento');
        }

        function enviarWhatsApp() {
            // Coletar todos os dados do formulário
            const dados = {
                // Dados da Empresa
                cnpj: document.getElementById('cnpj').value,
                razaoSocial: document.getElementById('razaoSocial').value,
                nomeFantasia: document.getElementById('nomeFantasia').value,
                dataAbertura: document.getElementById('dataAbertura').value,
                inscricaoEstadual: document.getElementById('inscricaoEstadual').value,
                situacaoCadastral: document.getElementById('situacaoCadastral').value,
                atividadePrincipal: document.getElementById('atividadePrincipal').value,
                naturezaJuridica: document.getElementById('naturezaJuridica').value,

                // Dados do Representante
                nomeRepresentante: document.getElementById('nomeRepresentante').value,
                rg: document.getElementById('rg').value,
                cpf: document.getElementById('cpf').value,
                dataNascimento: document.getElementById('dataNascimento').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value,

                // Endereço
                cep: document.getElementById('cep').value,
                logradouro: document.getElementById('logradouro').value,
                numero: document.getElementById('numero').value,
                complemento: document.getElementById('complemento').value,
                bairro: document.getElementById('bairro').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value,

                // Planos
                planoBlack: document.getElementById('planoBlack').value,
                quantidadeLinhas: document.getElementById('quantidadeLinhas').value,
                planoUltrafibra: document.getElementById('planoUltrafibra').value,
                dataVencimento: document.getElementById('dataVencimento').value,
                tipoLinha: document.getElementById('tipoLinha').value
            };

            // Criar a mensagem formatada
            let mensagem = `*Ficha TIM*\n\n`;
            
            mensagem += `*Dados da Empresa*\n`;
            mensagem += `CNPJ: ${dados.cnpj}\n`;
            mensagem += `Razão Social: ${dados.razaoSocial}\n`;
            mensagem += `Nome Fantasia: ${dados.nomeFantasia}\n`;
            mensagem += `Data de Abertura: ${dados.dataAbertura}\n`;
            mensagem += `Inscrição Estadual: ${dados.inscricaoEstadual}\n`;
            mensagem += `Situação Cadastral: ${dados.situacaoCadastral}\n`;
            mensagem += `Atividade Principal: ${dados.atividadePrincipal}\n`;
            mensagem += `Natureza Jurídica: ${dados.naturezaJuridica}\n\n`;
            
            mensagem += `*Dados do Representante Legal*\n`;
            mensagem += `Nome: ${dados.nomeRepresentante}\n`;
            mensagem += `RG: ${dados.rg}\n`;
            mensagem += `CPF: ${dados.cpf}\n`;
            mensagem += `Data de Nascimento: ${dados.dataNascimento}\n`;
            mensagem += `E-mail: ${dados.email}\n`;
            mensagem += `Telefone: ${dados.telefone}\n\n`;
            
            mensagem += `*Endereço*\n`;
            mensagem += `CEP: ${dados.cep}\n`;
            mensagem += `Logradouro: ${dados.logradouro}, ${dados.numero}\n`;
            mensagem += dados.complemento ? `Complemento: ${dados.complemento}\n` : '';
            mensagem += `Bairro: ${dados.bairro}\n`;
            mensagem += `Cidade: ${dados.cidade}\n`;
            mensagem += `Estado: ${dados.estado}\n\n`;
            
            mensagem += `*Planos*\n`;
            mensagem += `TIM Black: ${dados.planoBlack}\n`;
            mensagem += `Quantidade de Linhas: ${dados.quantidadeLinhas}\n`;
            mensagem += `TIM Ultrafibra: ${dados.planoUltrafibra}\n`;
            mensagem += `Data de Vencimento: ${dados.dataVencimento}\n`;
            mensagem += `Tipo de Linha: ${dados.tipoLinha}`;

            // Número do WhatsApp (substitua pelo número correto)
            const numeroWhatsApp = '5511999999999';

            // Criar o link do WhatsApp
            const linkWhatsApp = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;

            // Abrir o WhatsApp
            window.open(linkWhatsApp, '_blank');
        }

        // Mostrar/ocultar campos de outro endereço
        document.getElementById('enderecoEntrega').addEventListener('change', function() {
            const outroEndereco = document.getElementById('outroEndereco');
            outroEndereco.style.display = this.value === 'nao' ? 'block' : 'none';
        });

        // Adicionar máscaras aos campos
        document.getElementById('cnpj').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 14) {
                value = value.replace(/^(\d{2})(\d)/, '$1.$2');
                value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
                value = value.replace(/(\d{4})(\d)/, '$1-$2');
                e.target.value = value;
            }
        });

        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/^(\d{3})(\d)/, '$1.$2');
                value = value.replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
                value = value.replace(/\.(\d{3})(\d)/, '.$1-$2');
                e.target.value = value;
            }
        });

        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/^(\d{2})(\d)/, '($1) $2');
                value = value.replace(/(\d{5})(\d)/, '$1-$2');
                e.target.value = value;
            }
        });

        document.getElementById('cep').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/^(\d{5})(\d)/, '$1-$2');
                e.target.value = value;
            }
        });
    </script>
</body>
</html> 